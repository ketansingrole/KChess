<html>
<head>
    <!--  Including jQuery, another tool chessboardjs uses:-->
    <script src="../../chessboardjs-1.0.0/jquery/jquery-3.4.1.min.js"></script>
    <!--  Including the chessboardjs files:-->
    <script src="../../chessboardjs-1.0.0/js/chessboard-1.0.0.min.js"></script>
    <script src="../../chess.js-master/chess.js"></script>
    <link rel="stylesheet" href="../../chessboardjs-1.0.0/css/chessboard-1.0.0.min.css">
</head>

<style>
  body{
    margin: 0%;
    background-color: #FBF2ED;
  }
  .container {
    display: grid;
    grid-template-columns: 3% 50%;
    margin: 0%;
    border: 0%;
    height: 100%;
  }
  
  .nav-bar{
    padding: 5%;
    display: grid;
    background-color: #233152;
    grid-template-columns: 100%;
  }
  #settings{
    width: 100%;
    opacity: .5;
    align-self: end;
  }
  #settings:hover{
    opacity: 1;
  }
  #board1{
    margin: 5%;
    align-self: center;
  }
  

</style>



<body>
  <div class="container">
    <div class="nav-bar">
      <div id="settings">
        <img id="settings" src="../assets/settings-white-48dp.svg" alt="settings">
      </div>

    </div>
    <div id="board1"></div>
  </div>
</body>


  
  
<script>
//   if(window.speechSynthesis.getVoices().length == 0) {
// 	window.speechSynthesis.addEventListener('voiceschanged', function() {
// 		textToSpeech();
// 	});
// }
// else {
// 	// languages list available, no need to wait
// 	textToSpeech()
// }
const sound = new Audio()
sound.src = "../assets/Move.mp3"
function textToSpeech(text_position) {
	// get all voices that browser offers
	var available_voices = window.speechSynthesis.getVoices();

	// this will hold an english voice
	var english_voice = '';

	// find voice by language locale "en-US"
	// if not then select the first voice
	for(var i=0; i<available_voices.length; i++) {
		if(available_voices[i].lang === 'en-US') {
			english_voice = available_voices[i];
			break;
		}
	}
	if(english_voice === '')
		english_voice = available_voices[0];

	// new SpeechSynthesisUtterance object
	var utter = new SpeechSynthesisUtterance();
	utter.rate = 1;
	utter.pitch = 0.5;
	utter.text = text_position;
	utter.voice = english_voice;

	// event after text has been spoken
	// utter.onend = function() {
	// 	alert('Speech has finished');
	// }

	// speak
	window.speechSynthesis.speak(utter);
}

  var chess = new Chess();
  function onDrop (source, target, piece, newPos, oldPos, orientation) {
  console.log('Source: ' + source)
  console.log('Target: ' + target)
  console.log('Piece: ' + piece)
  console.log('New position: ' + Chessboard.objToFen(newPos))
  console.log('Old position: ' + Chessboard.objToFen(oldPos))
  console.log('Orientation: ' + orientation)
  console.log('~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~')
  if(chess.move({ from: source, to: target, promotion: 'q'}) == null){
    
    return 'snapback'
  }
  // textToSpeech(piece+" "+source+" "+target)

  console.log("displaying chess values")
  console.log(chess.pgn());
  sound.play()
  // temp = chess.history();
  // textToSpeech(temp[temp.length-1]);
}

function onSnapEnd () {
  board.position(chess.fen())
}
// --- Begin Example JS --------------------------------------------------------
var config = {
  draggable: true,
  dropOffBoard: 'snapback', // this is the default
  onDrop: onDrop,
  showNotation: true,
  onSnapEnd: onSnapEnd,
  pieceTheme: '../../chessboardjs-1.0.0/img/chesspieces/cburnett/{piece}.svg',
  position: 'start'
}
var board = Chessboard('board1', config)

window.addEventListener('resize', () => {
    console.log("RESIZE");
    board.resize();
});
// var Chess = require('./chess').Chess;


// --- End Example JS ----------------------------------------------------------

</script>

</html>